menu_path=Extract/ISI/start
label=Extract Document Co-Citation Network (Core and References)
description=Extract the document co-citation network from this database.
in_data=db:isi
out_data=prefuse.data.Graph
service.pid=edu.iu.sci2.database.isi.extract.network.cocitation.document.all
remoteable=true
node_query= \
-- Core documents. \n\
SELECT 'd' || Char(document.pk) AS id, \n\
Varchar(Coalesce(person.family_name || ' ' || Char(document.publication_year, 4), \n\
person.unsplit_name || ' ' || Char(document.publication_year, 4), \n\
document.title, \n\
'Document with ID ' || Char(document.pk)), \n\
32000) AS label, \n\
title, \n\
document_type AS publication_type, \n\
abstract_text, \n\
article_number, \n\
beginning_page, \n\
cited_reference_count, \n\
cited_year, \n\
digital_object_identifier, \n\
document_volume, \n\
ending_page, \n\
funding_agency_and_grant_number, \n\
funding_text, \n\
isbn, \n\
isi_document_delivery_number, \n\
isi_unique_article_identifier, \n\
issue, \n\
language, \n\
page_count, \n\
part_number, \n\
publication_date, \n\
publication_year, \n\
special_issue, \n\
subject_category, \n\
supplement, \n\
times_cited, \n\
Varchar(Coalesce(source.full_title, \n\
source.twenty_nine_character_source_title_abbreviation, \n\
source.iso_title_abbreviation, \n\
'Conference ' || source.conference_title, \n\
'Book Series ' || source.book_series_title, \n\
'Source with ID ' || Char(source.pk)), \n\
32000) AS source \n\
FROM   document \n\
LEFT JOIN person  --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (document.first_author_fk = person.pk) \n\
LEFT JOIN source --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (document.document_source_fk = source.pk) \n\
UNION \n\
-- Non-core documents. \n\
SELECT 'r' || Char(reference.pk) AS id, \n\
raw_reference_string      AS label, \n\
raw_reference_string      AS title, \n\
''                        AS publication_type, \n\
''                        AS abstract_text, \n\
''                        AS article_number, \n\
reference_page_number     AS beginning_page, \n\
-1                        AS cited_reference_count, \n\
reference_year            AS cited_year, \n\
digital_object_identifier, \n\
reference_volume          AS document_volume, \n\
-1                        AS ending_page, \n\
''                        AS funding_agency_and_grant_number, \n\
''                        AS funding_text, \n\
''                        AS isbn, \n\
''                        AS isi_document_delivery_number, \n\
''                        AS isi_unique_article_identifier, \n\
''                        AS issue, \n\
''                        AS language, \n\
-1                        AS page_count, \n\
''                        AS part_number, \n\
''                        AS publication_date, \n\
reference_year            AS publication_year, \n\
''                        AS special_issue, \n\
''                        AS subject_category, \n\
''                        AS supplement, \n\
-1                        AS times_cited, \n\
Varchar(Coalesce(source.full_title, \n\
source.twenty_nine_character_source_title_abbreviation, \n\
source.iso_title_abbreviation, \n\
'Conference ' || source.conference_title, \n\
'Book Series ' || source.book_series_title, \n\
'Source with ID ' || Char(source.pk)), \n\
32000) AS source \n\
FROM   reference \n\
LEFT JOIN source --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (reference.reference_source_fk = source.pk) \n\
WHERE  reference.paper_fk IS NULL
edge_query= \
-- Of core documents \n\
SELECT \n\
source, \n\
target, \n\
times_cocited, \n\
times_cocited AS weight, \n\
CAST(times_cocited * 1.0 / (d1refs + d2refs - times_cocited) AS DOUBLE) AS jaccard, \n\
CAST(times_cocited / (SQRT(d1refs) * SQRT(d2refs)) AS DOUBLE) AS cosine, \n\
CAST(times_cocited * 2.0 / (d1refs + d2refs) AS DOUBLE) AS dice, \n\
earliest_cocitation, \n\
latest_cocitation \n\
FROM \n\
(SELECT   'd' || Char(document1.pk) AS source, \n\
'd' || Char(document2.pk) AS target, \n\
Count(distinct citing_document.pk )                 AS times_cocited, \n\
d1refs.total AS d1refs, \n\
d2refs.total AS d2refs, \n\
Min(citing_document.publication_year) AS earliest_cocitation, \n\
Max(citing_document.publication_year) AS latest_cocitation \n\
FROM     cited_references cited_references1 \n\
JOIN cited_references cited_references2 \n\
ON (cited_references1.cited_references_document_fk = cited_references2.cited_references_document_fk) \n\
JOIN document citing_document \n\
ON (cited_references1.cited_references_document_fk = citing_document.pk) \n\
JOIN reference reference1 \n\
ON (cited_references1.cited_references_reference_fk = reference1.pk) \n\
JOIN document document1 \n\
ON (reference1.paper_fk = document1.pk) \n\
JOIN reference reference2 \n\
ON (cited_references2.cited_references_reference_fk = reference2.pk) \n\
JOIN document document2 \n\
ON (reference2.paper_fk = document2.pk) \n\
JOIN (SELECT paper_fk, count(distinct cited_references_document_fk) AS total \n\
FROM cited_references \n\
JOIN reference \n\
ON cited_references.cited_references_reference_fk = reference.pk \n\
GROUP BY paper_fk) \n\
AS d1refs \n\
ON (d1refs.paper_fk = document1.pk) \n\
JOIN (SELECT paper_fk, count(distinct cited_references_document_fk) AS total \n\
FROM cited_references \n\
JOIN reference \n\
ON cited_references.cited_references_reference_fk = reference.pk \n\
GROUP BY paper_fk) \n\
AS d2refs --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (d2refs.paper_fk = document2.pk) \n\
WHERE    document1.pk < document2.pk \n\
GROUP BY 'd' || Char(document1.pk), 'd' || Char(document2.pk), d1refs.total, d2refs.total \n\
UNION \n\
-- Of non-core documents \n\
SELECT   'r' || Char(reference1.pk) AS source, \n\
'r' || Char(reference2.pk) AS target, \n\
Count(distinct citing_document.pk )                  AS times_cocited, \n\
d1refs.total AS d1refs, \n\
d2refs.total AS d2refs, \n\
Min(citing_document.publication_year) AS earliest_cocitation, \n\
Max(citing_document.publication_year) AS latest_cocitation \n\
FROM     cited_references cited_references1 \n\
JOIN cited_references cited_references2 --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (cited_references1.cited_references_document_fk = cited_references2.cited_references_document_fk) \n\
JOIN document citing_document --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (cited_references1.cited_references_document_fk = citing_document.pk) \n\
JOIN reference reference1  --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (cited_references1.cited_references_reference_fk = reference1.pk) \n\
JOIN reference reference2  --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (cited_references2.cited_references_reference_fk = reference2.pk) \n\
JOIN (SELECT reference.pk, count(distinct cited_references_document_fk) AS total \n\
FROM cited_references \n\
JOIN reference \n\
ON cited_references.cited_references_reference_fk = reference.pk \n\
GROUP BY reference.pk) \n\
AS d1refs  --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (d1refs.pk = reference1.pk) \n\
JOIN (SELECT reference.pk, count(distinct cited_references_document_fk) AS total \n\
FROM cited_references \n\
JOIN reference \n\
ON cited_references.cited_references_reference_fk = reference.pk \n\
GROUP BY reference.pk) \n\
AS d2refs --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (d2refs.pk = reference2.pk) \n\
WHERE    reference1.pk < reference2.pk \n\
AND reference1.paper_fk IS NULL -- Exclude cited documents which happen to be core documents \n\
AND reference2.paper_fk IS NULL -- Exclude cited documents which happen to be core documents \n\
GROUP BY 'r' || Char(reference1.pk), 'r' || Char(reference2.pk), d1refs.total, d2refs.total \n\
UNION \n\
-- Between core and non-core documents \n\
SELECT   'd' || Char(document.pk)   AS source, \n\
'r' || Char(reference2.pk) AS target, \n\
Count(distinct citing_document.pk )                  AS times_cocited, \n\
d1refs.total AS d1refs, \n\
d2refs.total AS d2refs, \n\
Min(citing_document.publication_year) AS earliest_cocitation, \n\
Max(citing_document.publication_year) AS latest_cocitation \n\
FROM     cited_references cited_references1 \n\
JOIN cited_references cited_references2 \n\
ON (cited_references1.cited_references_document_fk = cited_references2.cited_references_document_fk) \n\
JOIN document citing_document \n\
ON (cited_references1.cited_references_document_fk = citing_document.pk) \n\
JOIN reference reference1 \n\
ON (cited_references1.cited_references_reference_fk = reference1.pk) \n\
JOIN document \n\
ON (reference1.paper_fk = document.pk) \n\
JOIN reference reference2 \n\
ON (cited_references2.cited_references_reference_fk = reference2.pk) \n\
JOIN (SELECT paper_fk, count(distinct cited_references_document_fk) AS total \n\
FROM cited_references \n\
JOIN reference --DERBY-PROPERTIES joinStrategy=HASH \n\
ON cited_references.cited_references_reference_fk = reference.pk \n\
GROUP BY paper_fk) \n\
AS d1refs \n\
ON (d1refs.paper_fk = document.pk) \n\
JOIN (SELECT reference.pk, count(distinct cited_references_document_fk) AS total \n\
FROM cited_references \n\
JOIN reference --DERBY-PROPERTIES joinStrategy=HASH \n\
ON cited_references.cited_references_reference_fk = reference.pk \n\
GROUP BY reference.pk) \n\
AS d2refs --DERBY-PROPERTIES joinStrategy=HASH \n\
ON (d2refs.pk = reference2.pk) \n\
WHERE    reference2.paper_fk IS NULL -- Exclude cited documents which happen to be core documents \n\
GROUP BY 'd' || Char(document.pk), 'r' || Char(reference2.pk), d1refs.total, d2refs.total) AS nested_query
id_column=ID
source_column=SOURCE
target_column=TARGET
directed=false
output_label=Document Co-Citation Network (Core and References)
documentation_url=http://wiki.cns.iu.edu/display/CISHELL/Extract+Document+Co-Citation+Network+%28Core+and+References%29
