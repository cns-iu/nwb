menu_path=Extract/From ISI Database/start
label=Extract Document Bibliographic Coupling Network
description=Extract the document bibliographic coupling network from this ISI database.
in_data=db:isi
out_data=prefuse.data.Graph
service.pid=edu.iu.sci2.database.isi.extract.network.bibcoupling.document
remoteable=true
documentation_url=http://wiki.slis.indiana.edu:8080/display/ALGDOC/Extract+Document+Bibliographic+Coupling+Network

node_query= \
SELECT document.pk AS id, \n\
       Coalesce(person.family_name || ' ' || Char(document.publication_year, 4), \n\
                person.unsplit_name || ' ' || Char(document.publication_year, 4), \n\
                document.title, \n\
                'Document with ID ' || Char(document.pk)) AS label, \n\
       Coalesce(source.full_title, \n\
                source.twenty_nine_character_source_title_abbreviation, \n\
                source.iso_title_abbreviation, \n\
                'Conference ' || source.conference_title, \n\
                'Book Series ' || source.book_series_title, \n\
                'Source with ID ' || Char(source.pk)) AS source, \n\
       document.abstract_text, \n\
       document.article_number, \n\
       document.beginning_page, \n\
       document.cited_reference_count, \n\
       document.cited_year, \n\
       document.digital_object_identifier, \n\
       document.document_type, \n\
       document.document_volume, \n\
       document.ending_page, \n\
       document.funding_agency_and_grant_number, \n\
       document.funding_text, \n\
       document.isbn, \n\
       document.isi_document_delivery_number, \n\
       document.isi_unique_article_identifier, \n\
       document.issue, \n\
       document.language, \n\
       document.page_count, \n\
       document.part_number, \n\
       document.publication_date, \n\
       document.publication_year, \n\
       document.special_issue, \n\
       document.subject_category, \n\
       document.supplement, \n\
       document.times_cited, \n\
       document.title \n\
FROM   document \n\
       LEFT JOIN person \n\
         ON (document.first_author_fk = person.pk) \n\
       LEFT JOIN source \n\
         ON (document.document_source_fk = source.pk)
# Times coupled:
# Consider all references on both documents.
# Count the number of DISTINCT references that they share.
#
# Normalizing factors:
# Count the total number of distinct references for each document.
#
# Note that we consider two references to be the same according to reference primary key equality.
edge_query= \
SELECT   cr1.cited_references_document_fk                                            AS source, \n\
         cr2.cited_references_document_fk                                            AS target, \n\
         Count(* )                                                                   AS times_coupled, \n\
         Count(* )                                                                   AS weight, \n\
         Cast(Count(* ) * 1.0 / (d1refs.total + d2refs.total - Count(* )) AS DOUBLE) AS jaccard, \n\
         Cast(Count(* ) * 1.0 / (Sqrt(d1refs.total) * Sqrt(d2refs.total)) AS DOUBLE) AS cosine, \n\
         Cast(Count(* ) * 2.0 / (d1refs.total + d2refs.total) AS DOUBLE)             AS dice \n\
FROM     cited_references cr1 \n\
         JOIN reference r1 --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (cr1.cited_references_reference_fk = r1.pk) \n\
         JOIN reference r2 --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (r1.pk = r2.pk) \n\
         JOIN cited_references cr2 --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (r2.pk = cr2.cited_references_reference_fk) \n\
         JOIN (SELECT   cited_references_document_fk, \n\
                        Count(* ) AS total \n\
               FROM     cited_references \n\
               GROUP BY cited_references_document_fk) AS d1refs \n\
			   --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (d1refs.cited_references_document_fk = cr1.cited_references_document_fk) \n\
         JOIN (SELECT   cited_references_document_fk, \n\
                        Count(* ) AS total \n\
               FROM     cited_references \n\
               GROUP BY cited_references_document_fk) AS d2refs \n\
			   --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (d2refs.cited_references_document_fk = cr2.cited_references_document_fk) \n\
WHERE    cr1.cited_references_document_fk < cr2.cited_references_document_fk \n\
GROUP BY cr1.cited_references_document_fk, \n\
         cr2.cited_references_document_fk, \n\
         d1refs.total, \n\
         d2refs.total
id_column=ID
source_column=SOURCE
target_column=TARGET
directed=false
output_label=Document Bibliographic Coupling Network
documentation_url=https://nwb.slis.indiana.edu/community/?n=Sci2Algorithm.ISIDocumentBibCouplingNetwork