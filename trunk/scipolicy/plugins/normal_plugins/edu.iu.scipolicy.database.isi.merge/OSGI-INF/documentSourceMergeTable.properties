menu_path=Data Preparation/Database/ISI/start
label=Create Document Source Merging Table
description=Create a merging table for document sources in this ISI database.
in_data=db:isi
out_data=prefuse.data.Table
service.pid=edu.iu.sci2.database.isi.merge.document_source.CreateDocumentSourceMergingTable
remoteable=true
documentation_url=https://nwb.slis.indiana.edu/community/?n=Sci2Algorithm.ISICreateDocumentSourceMergingTable
output_label=Document Source Merging Table
# Note the usefulness of this query depends on
# the special column names "Merge Group Identifier", "Primary Entity", and "From table: APP.SOURCE".
# See the String constants in edu.iu.cns.database.merge.generic.CreateMergingTable.
query=\
SELECT   s.pk, \n\
         s.twenty_nine_character_source_title_abbreviation, \n\
         Coalesce(docsource.docu, 0)  AS "Number of papers from", \n\
         Coalesce(refsource.refer, 0) AS "Number of references to", \n\
         book_series_title, \n\
         book_series_subtitle, \n\
         conference_host, \n\
         conference_location, \n\
         conference_sponsors, \n\
         conference_title, \n\
         full_title, \n\
         iso_title_abbreviation, \n\
         issn, \n\
         publication_type, \n\
		 s.pk                         AS "Merge Group Identifier", \n\
         '*'                          AS "Primary Entity", \n\
         ''                           AS "From table: APP.SOURCE" \n\
FROM     source s \n\
         LEFT JOIN (SELECT   source.pk, \n\
                             Count(document.pk) AS docu \n\
                    FROM     source \n\
                             JOIN document --DERBY-PROPERTIES joinStrategy=HASH \n\
                               ON (source.pk = document.document_source_fk) \n\
                    GROUP BY source.pk) AS docsource \n\
           --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (s.pk = docsource.pk) \n\
         LEFT JOIN (SELECT   source.pk, \n\
                             Count(cited_references.cited_references_document_fk) AS refer \n\
                    FROM     source \n\
                             JOIN reference --DERBY-PROPERTIES joinStrategy=HASH \n\
                               ON (source.pk = reference.reference_source_fk) \n\
                             JOIN cited_references --DERBY-PROPERTIES joinStrategy=HASH \n\
                               ON (reference.pk = cited_references.cited_references_reference_fk) \n\
                    GROUP BY source.pk) AS refsource \n\
           --DERBY-PROPERTIES joinStrategy=HASH \n\
           ON (s.pk = refsource.pk)