menu_path=Extract/From ISI Database/end
label=Extract References by Year
description=This algorithm extracts the references out of an ISI database into a table.
in_data=db:isi
out_data=prefuse.data.Table
service.pid=edu.iu.scipolicy.database.isi.extract.table.entities_by_year.ExtractReferencesByYearAlgorithm
remoteable=true

query = \
SELECT \n\
	REFERENCE AS "Reference", \n\
	REFERENCE_ID "Reference ID", \n\
	"Year", \n\
	COUNT (*) AS "Count" \n\
FROM \n\
	( \n\
		SELECT \n\
			REFERENCE.RAW_REFERENCE_STRING AS REFERENCE, \n\
			REFERENCE.PK AS REFERENCE_ID, \n\
			VARCHAR ( \n\
					COALESCE ( \n\
						CHAR (DOCUMENT.PUBLICATION_YEAR, 4), \n\
						'**NO PUBLICATION YEAR**'), \n\
					32000) \n\
				AS "Year" \n\
		FROM \n\
			REFERENCE \n\
		JOIN \n\
			CITED_REFERENCES \n\
				ON (REFERENCE.PK = CITED_REFERENCES.CITED_REFERENCES_REFERENCE_FK) \n\
		JOIN \n\
			DOCUMENT \n\
				ON (CITED_REFERENCES.CITED_REFERENCES_DOCUMENT_FK = DOCUMENT.PK) \n\
	) AS TEMP \n\
GROUP BY \n\
	REFERENCE, \n\
	REFERENCE_ID, \n\
	"Year"

#query = \
#SELECT \n\
#	REFERENCE AS "Reference", \n\
#	REFERENCE_ID "Reference ID", \n\
#	"Year", \n\
#	COUNT (*) AS "Count" \n\
#FROM \n\
#	( \n\
#		SELECT \n\
#			REFERENCE.RAW_REFERENCE_STRING AS REFERENCE, \n\
#			REFERENCE.PK AS REFERENCE_ID, \n\
#			DOCUMENT.PUBLICATION_YEAR AS "Year" \n\
#		FROM \n\
#			REFERENCE \n\
#		JOIN \n\
#			CITED_REFERENCES \n\
#				ON (REFERENCE.PK = CITED_REFERENCES.CITED_REFERENCES_REFERENCE_FK) \n\
#		JOIN \n\
#			DOCUMENT \n\
#				ON (CITED_REFERENCES.CITED_REFERENCES_DOCUMENT_FK = DOCUMENT.PK) \n\
#	) AS TEMP \n\
#GROUP BY \n\
#	REFERENCE, \n\
#	REFERENCE_ID, \n\
#	"Year"

output_label = References by Year