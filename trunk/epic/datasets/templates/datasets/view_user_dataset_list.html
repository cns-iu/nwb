{# This Script displays the datasets for a particular author. Might need to refactor this into the Profile later on. #}
{% extends "core/bases/browse_base.html" %}
{% block css %}
{{ block.super }}
<link href="/core_media/css/star_rating.css" rel="stylesheet" type="text/css" />
{% endblock %}

{% load tags_templatetags %}
{% show_tag_cloud %}

{% block content %}

{% if messages %}
	<div class="highlight" id="message">
		<ul>
		{% for message in messages %}
			<li>{{ message }}</li>
		{% endfor %}
		</ul>
	</div>
{% endif %}





{% if datasets %}

	<div class="datasets-authorname">
	
	Datasets for 
	
	{{ requested_user.get_full_name }}
	
	[ {{ requested_user.username }} ]
	
	</div>
	
	{% comment %}
		'''
		"rate_box_view_helper" has to be always loaded whenever we are loading the 
		"rate_box_view" because of a dependecy JavaScript code that will be required 
		by this template.
		'''
	{% endcomment %}
	
	{% load djangoratings_templatetags %}
	{% rate_box_view_helper %}
	
 	{% for dataset in datasets %}
		<div id="databox">


  <div class="downloadicon"></div>
	
	{% load djangoratings_templatetags %}
	{% rate_box_view dataset user %}
	
	<h1><a href="{% url datasets.views.view_dataset item_id=dataset.id %}">{{ dataset.name|escape }}</a></h1>
	<p>{{ dataset.description|escape|truncatewords:100 }}</p>

   	{% load tags_templatetags %}
	{% list_item_tags dataset user %}
 	
 	{% if user and user.is_authenticated %}
    <h3>Dataset Files</h3>
    
    <p>
      {% if dataset.files %}
        {% for file in dataset.files.all %}      
          {# TODO: this should be a reverse? #}
            <a href="{{ file.file_contents.url }}">
              <img src="/core_media/images/download-icon_30.jpg" width="69" height="17" align="texttop" />
            </a>
            
            {{ file.get_short_name }}
            <br />
        {% endfor %}
        
        {# TODO: Implement Download All functionality. #}
        {% ifnotequal dataset.files.all|length 0 %}
          <br />
          <a href="{{ dataset.get_download_all_files_url }}">
            <img src="/core_media/images/download-all_19.jpg" width="87" height="18" />
          </a>
          
          Download All Files
        {% endifnotequal %}
      {% else %}
        No attached files
      {% endif %}
    </p>
  {% endif %}
 	
 	 
</div>
	{% endfor %}
{% endif %}

{% endblock %}
