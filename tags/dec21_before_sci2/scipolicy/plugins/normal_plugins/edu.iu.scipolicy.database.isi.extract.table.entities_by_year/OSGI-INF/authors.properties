menu_path=Extract/From ISI Database/end
label=Extract Authors by Year
description=This algorithm extracts the authors out of an ISI database into a table by year.
in_data=db:isi
out_data=prefuse.data.Table
service.pid=edu.iu.scipolicy.database.isi.extract.table.entities_by_year.ExtractAuthorsByYearAlgorithm
remoteable=true

query = \
SELECT \n\
	"Author", \n\
	"Year", \n\
	"Author ID", \n\
	COUNT (*) AS "Number Of Documents", \n\
	COUNT2 AS "Citations Received In This Year", \n\
	COUNT3 AS "Times Documents From This Year Are Cited" \n\
FROM \n\
	(SELECT \n\
			COALESCE ( \n\
				PERSON.FULL_NAME, \n\
				PERSON.UNSPLIT_NAME, \n\
				'**NO NAME SPECIFIED**') \n\
			AS "Author", \n\
		PERSON.PK AS "Author ID", \n\
			VARCHAR ( \n\
					COALESCE ( \n\
						CHAR (DOCUMENT.PUBLICATION_YEAR, 4), \n\
						'**NO PUBLICATION YEAR**'), \n\
					30) \n\
				AS "Year", \n\
		DOCUMENT.PUBLICATION_YEAR \n\
	FROM \n\
		DOCUMENT \n\
	JOIN \n\
		AUTHORS \n\
			ON (DOCUMENT.PK = AUTHORS.AUTHORS_DOCUMENT_FK) \n\
	JOIN \n\
		PERSON \n\
			ON (AUTHORS.AUTHORS_PERSON_FK = PERSON.PK) \n\
	) AS TEMP1 \n\
LEFT JOIN \n\
	(SELECT \n\
		AUTHORS.AUTHORS_PERSON_FK AS AUTHOR_ID2, \n\
		DOCUMENT2.PUBLICATION_YEAR AS YEAR2, \n\
		COUNT (*) AS COUNT2 \n\
	FROM \n\
		AUTHORS \n\
	JOIN \n\
		DOCUMENT DOCUMENT1 \n\
			ON (AUTHORS.AUTHORS_DOCUMENT_FK = DOCUMENT1.PK) \n\
	JOIN \n\
		REFERENCE \n\
			ON (DOCUMENT1.PK = REFERENCE.PAPER_FK) \n\
	JOIN \n\
		CITED_REFERENCES \n\
			ON (REFERENCE.PK = CITED_REFERENCES.CITED_REFERENCES_REFERENCE_FK) \n\
	JOIN \n\
		DOCUMENT DOCUMENT2 \n\
			ON (CITED_REFERENCES.CITED_REFERENCES_DOCUMENT_FK = DOCUMENT2.PK) \n\
	GROUP BY \n\
		AUTHORS.AUTHORS_PERSON_FK, \n\
		DOCUMENT2.PUBLICATION_YEAR \n\
	) AS TEMP2 --DERBY-PROPERTIES joinStrategy=HASH \n\
		ON (("Author ID" = TEMP2.AUTHOR_ID2) AND (TEMP1.PUBLICATION_YEAR = TEMP2.YEAR2)) \n\
LEFT JOIN \n\
	(SELECT \n\
		AUTHORS.AUTHORS_PERSON_FK AS AUTHOR_ID3, \n\
		DOCUMENT.PUBLICATION_YEAR AS YEAR3, \n\
		COUNT (*) AS COUNT3 \n\
	FROM \n\
		AUTHORS \n\
	JOIN \n\
		DOCUMENT \n\
			ON (AUTHORS.AUTHORS_DOCUMENT_FK = DOCUMENT.PK) \n\
	JOIN \n\
		REFERENCE \n\
			ON (DOCUMENT.PK = REFERENCE.PAPER_FK) \n\
	JOIN \n\
		CITED_REFERENCES \n\
			ON (REFERENCE.PK = CITED_REFERENCES.CITED_REFERENCES_REFERENCE_FK) \n\
	GROUP BY \n\
		AUTHORS.AUTHORS_PERSON_FK, \n\
		DOCUMENT.PUBLICATION_YEAR \n\
	) AS TEMP3 --DERBY-PROPERTIES joinStrategy=HASH \n\
		ON (("Author ID" = TEMP3.AUTHOR_ID3) AND (TEMP1.PUBLICATION_YEAR = TEMP3.YEAR3)) \n\
GROUP BY \n\
	"Author", \n\
	"Year", \n\
	"Author ID", \n\
	COUNT2, \n\
	COUNT3

#query = \
#SELECT \n\
#	"Author", \n\
#	"Year", \n\
#	"Author ID", \n\
#	COUNT (*) AS "Count" \n\
#FROM \n\
#	(SELECT \n\
#			COALESCE ( \n\
#				PERSON.FULL_NAME, \n\
#				PERSON.UNSPLIT_NAME, \n\
#				'**NO NAME SPECIFIED**') \n\
#			AS "Author", \n\
#		PERSON.PK AS "Author ID", \n\
#			VARCHAR ( \n\
#					COALESCE ( \n\
#						CHAR (DOCUMENT.PUBLICATION_YEAR, 4), \n\
#						'**NO PUBLICATION YEAR**'), \n\
#					32000) \n\
#				AS "Year" \n\
#	FROM \n\
#		DOCUMENT \n\
#	JOIN \n\
#		AUTHORS \n\
#			ON (DOCUMENT.PK = AUTHORS.AUTHORS_DOCUMENT_FK) \n\
#	JOIN \n\
#		PERSON \n\
#			ON (AUTHORS.AUTHORS_PERSON_FK = PERSON.PK) \n\
#	) AS TEMP \n\
#GROUP BY \n\
#	"Author", \n\
#	"Year", \n\
#	"Author ID"

output_label = Authors by Year
