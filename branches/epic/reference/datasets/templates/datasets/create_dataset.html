{% extends "core/bases/simple_base.html" %}
{% block nav %}
  <div id="nav">
    {% load core_templatetags %}
    {% nav_bar 'Upload' %}
  </div>
{% endblock %}{# block nav #}
{% block scripts_header %}
	{{ block.super }}
	<script type="text/javascript" src="/core_media/scripts/image_swap.js"></script>
{% endblock %}

{% block content %}
<h1>Upload Your Data</h1>
<form enctype="multipart/form-data" action="{% url datasets.views.create_dataset %}" method="POST">
    <table class="form">
        {% load core_templatetags %}
        {% include_form_as_table form 'True' %}
  		{{ ref_formset.as_table }}
    </table>
	{% load geoloc_templatetags%}
	{% add_locations_map_for_dataset add_formset remove_formset %}
    <input type="image" alt="Submit New Dataset" src="/core_media/images/submit.jpg" value="Upload" />
</form>

<script type="text/javascript">
var formPrefix = 'reference';
var last_id;
initalize();

function initalize(){
	last_id = getLast(formPrefix);
	insertAddButton();
}
function getLast(){
	var manager = document.getElementById('id_' + formPrefix + '-TOTAL_FORMS');
	return manager.value - 1;
}
function insertAddButton(){
	var lastReference = getLastReference();

	addLink = document.createElement('a');
	addLink.setAttribute('onclick', 'addReference(); return false;');
	addLink.innerHTML= 'Add More';
	lastReference.parentNode.insertBefore(addLink, lastReference.nextSibling);	
}
function getLastReference(){
	var lastReference = document.getElementById('id_'+ formPrefix + '-' + last_id + '-' + formPrefix);
	return lastReference;
}
function addReference(){
	var lastReference = getLastReference();
	var referenceToAdd = createReference(formPrefix, ++last_id, '');
	var br = document.createElement('br');
	
	lastReference.parentNode.insertBefore(br, lastReference.nextSibling);
	br.parentNode.insertBefore(referenceToAdd, br.nextSibling);

	var manager = document.getElementById('id_' + formPrefix + '-TOTAL_FORMS');
	manager.setAttribute('value', last_id + 1);
}
function createReference(formPrefix, formNumber, formValue){
	var id = 'id_' + formPrefix + '-' + formNumber + '-' + formPrefix;
	var value = formValue;
	var name = formPrefix + '-' + formNumber + '-' + formPrefix;
	var reference = document.createElement('input');

	reference.setAttribute('type', 'text');
	reference.setAttribute('id', id);
	reference.setAttribute('value', value);
	reference.setAttribute('name', name);

	return reference;
}
</script>
{% endblock %}